<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><title>Zzr blog</title><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="/public/css/normalize.css" type="text/css"><link rel="stylesheet" href="/public/css/main.css" type="text/css"><link rel="stylesheet" href="/public/css/unit.css" type="text/css"><link rel="stylesheet" href="/public/css/markdown.css" type="text/css"></head><body><!--if lte IE 8p.browser-upgrade
  | &#x60A8;&#x7684;&#x6D4F;&#x89C8;&#x5668;&#x7248;&#x672C;&#x90FD;&#x8001;&#x7684;&#x6389;&#x7259;&#x5566;&#xFF0C;&#x8BF7;&#x5230;
  a(href='http://browsehappy.com') &#x8FD9;&#x91CC;
  | &#x66F4;&#x65B0;&#xFF0C;&#x4EE5;&#x83B7;&#x53D6;&#x6700;&#x4F73;&#x4F53;&#x9A8C;--><section class="sidebar"><div class="header"><img src="/public/img/sidebar-brand.jpg" alt="brand" class="header-brand"><h1 class="header-name">Zzr&#x7684;&#x535A;&#x5BA2;</h1></div><nav class="main"><ul><li class="active"><a href="/" title="博客首页"><i class="iconfont">&#xE600;</i><span>home</span></a></li><li><a href="/demo" title="小的demo"><i class="iconfont">&#xE603;</i><span>demo</span></a></li><li><a href="#" title="关于"><i class="iconfont">&#xE612;</i><span>about</span></a></li><li><a href="https://github.com/Zhangzirui/" title="我的github"><i class="iconfont">&#xE611;</i><span>github</span></a></li></ul></nav><div style="display: none" class="menu"><i class="iconfont menu-icon">&#xE606;</i><ul style="display: none"><li class="active"><a href="#" title="博客首页"><i class="iconfont">&#xE600;</i><span>home</span></a></li><li><a href="#" title="小的demo"><i class="iconfont">&#xE603;</i><span>demo</span></a></li><li><a href="#" title="关于"><i class="iconfont">&#xE612;</i><span>about</span></a></li><li><a href="#" title="我的github"><i class="iconfont">&#xE611;</i><span>github</span></a></li></ul></div></section><div class="container"><div class="main"><article class="markdown"></p>

<h2>总结自己编写原生JS总踩的坑</h2>

<blockquote><p>这一篇会持续更新</p></blockquote>

<h3>document.compatMode产生的问题</h3>

<p>document.compatMode是用来判断当前浏览器的渲染模式，如下：</p>

<p>当<code>document.compatMode == &#39;BackCompat&#39;</code>,是指标准兼容模式关闭。在计算<code>clientWidth,scrollTop</code>之类的距离时，要用<code>document.body</code>。</p>

<p>而当<code>document.compatMode == &#39;CSS1Compat&#39;</code>,是指标准兼容模式开启。在计算<code>clientWidth,scrollTop</code>之类的距离时，要用<code>document.documentElement</code>。</p>

<p>就连第3版《Javascript高级程序设计》一书中也写到过这样的代码：</p>

<pre><code>if(document.compatMode == &quot;CSS1Compat&quot;){
	alter(document.documentElement.scrollTop)
}else{
	alter(document.body.scrollTop)
}</code></pre>

<p>可是在实际使用过程中，<strong>这段代码在谷歌浏览器下是会出现错误</strong>的。（我自己就好几次被坑在这里了，所以踩坑后一定要总结总结再总结）</p>

<p>在谷歌浏览器下，<code>document.compatMode==&#39;CSS1Compat&#39;</code>时，<code>document.documentElement.scrollTop</code>是<strong>等于0</strong>的，而<code>document.body.scrollTop</code>才是正确的值。同样有这个问题的还有<code>scrollLeft</code>。</p>

<p>所以以上代码可以改成</p>

<pre><code>if(document.compatMode == &quot;CSS1Compat&quot;){
	alter(document.documentElement.scrollTop==0 ? document.body.scrollTop : document.documentElement.scrollTop)
}else{
	alter(document.body.scrollTop)
}</code></pre><div class="pay"><div class="pay-content"><p>如果这篇文章对你很有帮助，你可以犒劳一下WO</p><a class="pay-btn">打赏</a></div></div></article></div><div class="elevator"><ul><li id="goTop" title="返回顶部"><i class="iconfont">&#xE605;</i></li></ul></div><footer><p class="copyright">Copyright &copy; Zhangzirui</p></footer></div><script type="text/javascript" src="/public/js/require.js" data-main="/public/js/main.js"></script></body></html>